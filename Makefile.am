# $Id$

ACLOCAL_AMFLAGS = -I m4
AM_CXXFLAGS = ${QT_CFLAGS}
AM_LDFLAGS = ${QT_LIBS}

EXTRA_DIST = base-server.pro

INCLUDES = \
-I$(top_srcdir)/base \
-I$(top_srcdir)/base-qt

noinst_HEADERS = \
ApplicationId.h \
ApplicationManager.h \
BaseApplication.h \
BaseCoreApplication.h \
Client.h \
ServerCommand.h \
ServerConfiguration.h \
ServerXmlDef.h

sources = \
ApplicationId.cpp \
ApplicationManager.cpp \
BaseApplication.cpp \
BaseCoreApplication.cpp \
Client.cpp \
ServerCommand.cpp \
ServerConfiguration.cpp

nodist_sources = \
moc_ApplicationManager.cpp \
moc_BaseApplication.cpp \
moc_BaseCoreApplication.cpp \
moc_Client.cpp

# executable
BUILT_SOURCES = testexternals.c
noinst_PROGRAMS = testexternals

testexternals.c:
	echo "//*** this is a generated file. Do not commit, do not edit" > $@
	echo "int main()" >> $@
	echo "{" >> $@
	echo "  return 0;" >> $@
	echo "}" >> $@

# shared library
if ENABLE_SHARED
lib_LTLIBRARIES = libbase-server.la
libbase_server_la_LIBADD = -lbase -lbase-qt

libbase_server_la_SOURCES =  $(sources)
nodist_libbase_server_la_SOURCES = $(nodist_sources)
libbase_server_la_CXXFLAGS = $(AM_CXXFLAGS)

testexternals_LDADD = libbase-server.la

else

# static library
noinst_LIBRARIES = libbase-server.a
libbase_server_a_SOURCES = $(sources)
nodist_libbase_server_a_SOURCES = $(nodist_sources)
libbase_server_a_XXCFLAGS = $(AM_CXXFLAGS)

testexternals_LDADD = \
  libbase-server.a \
  ../base-qt/libbase-qt.a \
  ../base/libbase.a

endif

# clean
clean-local:
	 rm -f moc_*.cpp

### rule to generate qt meta objects
moc_%.cpp: %.h
	moc $^ -o $@
